<template>
	<div class="slds-is-relative">
		<lightning-spinner
			if:true={isLoading}
			alternative-text="Loading"
			size="large"
			class="slds-is-absolute"></lightning-spinner>
		<div>
			<lightning-modal-body>
				<div
					class="slds-grid slds-wrap slds-gutters"
					style="padding: 10px 50px">
					<lightning-layout
						horizontal-align="center"
						style="width: 100%">
						<lightning-layout-item
							size="12"
							large-device-size="10"
							small-device-size="12">
							<h1><span>{labels.popupHeader}</span></h1>
							<p
								class="subHeader"
								style={subheaderCSS}>
								{labels.popupSubheader}
							</p>
						</lightning-layout-item>
					</lightning-layout>
					<template
						if:true={sections}
						for:each={sections}
						for:item="section">
						<lightning-layout
							horizontal-align="center"
							key={section.header}
							multiple-rows="true">
							<lightning-layout-item
								size="12"
								large-device-size="10"
								small-device-size="12">
								<div key={section.header}>
									<div>
										<lightning-layout
											if:true={section.header}
											horizontal-align="spread"
											multiple-rows="true">
											<lightning-layout-item
												padding="around-small"
												size="12"
												large-device-size="10"
												small-device-size="12">
												<div style="float: left">
													<h1>
														<span style={subheaderCSS}> {section.header} </span>
													</h1>
													<p
														if:true={section.subHeader}
														class="subHeader">
														{section.subHeader}
													</p>
												</div>
											</lightning-layout-item>
										</lightning-layout>
										<lightning-layout multiple-rows="true">
											<template
												if:true={section.fields}
												for:each={section.fields}
												for:item="field">
												<lightning-layout-item
													padding="around-small"
													size="12"
													small-device-size="12"
													medium-device-size={field.screenSize}
													large-device-size={field.screenSize}
													key={field.fieldName}>
													<div
														style="display: flex"
														class="slds-grid slds-grid_vertical-align-center">
														<div style="width: 100%">
															<label class="slds-form-element__label">
																{field.fieldLabel}
																<template if:false={showEditBtn}>
																	<template if:true={field.isRequired}>*</template>
																</template>
															</label>
															<lightning-helptext
																if:true={field.helpText}
																content={field.helpText}></lightning-helptext>
															<lightning-input
																if:true={field.isNumber}
																type="number"
																step="0.01"
																formatter={field.type}
																variant="label-hidden"
																label={field.fieldLabel}
																name={field.fieldName}
																read-only={field.isReadOnly}
																required={field.isRequired}></lightning-input>
															<lightning-input
																if:true={field.isCheckbox}
																type="checkbox"
																variant="label-hidden"
																label={field.fieldLabel}
																name={field.fieldName}
																read-only={field.isReadOnly}
																required={field.isRequired}></lightning-input>
															<lightning-input
																if:true={field.isText}
																type="text"
																variant="label-hidden"
																label={field.fieldLabel}
																name={field.fieldName}
																read-only={field.isReadOnly}
																required={field.isRequired}></lightning-input>
															<lightning-input
																if:true={field.isEmail}
																type={field.type}
																variant="label-hidden"
																label={field.fieldLabel}
																name={field.fieldName}
																read-only={field.isReadOnly}
																required={field.isRequired}></lightning-input>
															<lightning-input
																if:true={field.isPhone}
																type="tel"
																variant="label-hidden"
																label={field.fieldLabel}
																name={field.fieldName}
																read-only={field.isReadOnly}
																required={field.isRequired}></lightning-input>
															<lightning-input
																if:true={field.isUrl}
																type={field.type}
																variant="label-hidden"
																label={field.fieldLabel}
																name={field.fieldName}
																read-only={field.isReadOnly}
																required={field.isRequired}></lightning-input>
															<lightning-textarea
																if:true={field.isTextarea}
																variant="label-hidden"
																label={field.fieldLabel}
																name={field.fieldName}
																read-only={field.isReadOnly}
																required={field.isRequired}></lightning-textarea>
															<template if:true={field.isReadOnly}>
																<lightning-combobox
																	if:true={field.isPicklist}
																	variant="label-hidden"
																	label={field.fieldLabel}
																	placeholder="None"
																	options={field.values}
																	name={field.fieldName}
																	read-only
																	required={field.isRequired}></lightning-combobox>
															</template>
															<template if:false={field.isReadOnly}>
																<lightning-combobox
																	if:true={field.isPicklist}
																	variant="label-hidden"
																	label={field.fieldLabel}
																	placeholder="None"
																	options={field.values}
																	name={field.fieldName}
																	class="editable"
																	required={field.isRequired}></lightning-combobox>
															</template>
															<lightning-input
																if:true={field.isDate}
																type={field.type}
																date-style="short"
																variant="label-hidden"
																label={field.fieldLabel}
																name={field.fieldName}
																data-name={field.fieldName}
																read-only={field.isReadOnly}
																required={field.isRequired}
																pattern="[0-9]{2}-[0-9]{2}-[0-9]{4}"></lightning-input>
															<template if:true={isDesktop}>
																<lightning-dual-listbox
																	if:true={field.isMultiPicklist}
																	name={field.fieldName}
																	read-only={field.isReadOnly}
																	label={field.fieldLabel}
																	options={field.values}
																	variant="label-hidden"
																	required={field.isRequired}
																	size="4"
																	disable-reordering
																	onchange={changeMultiSelectList}>
																</lightning-dual-listbox>
															</template>
															<template if:false={isDesktop}>
																<select
																	if:true={field.isMultiPicklist}
																	class="slds-select multiselect"
																	multiple=""
																	size="4"
																	name={field.fieldName}
																	required={field.isRequired}>
																	<option value="">None</option>
																	<template
																		if:true={field.values}
																		for:each={field.values}
																		for:item="pickVal">
																		<option
																			key={pickVal.value}
																			value={pickVal.value}>
																			{pickVal.label}
																		</option>
																	</template>
																</select>
															</template>
															<div
																if:true={field.isMultiPicklist}
																role="alert"
																class="requiredError">
																{labels.requiredFieldMessage}
															</div>
														</div>
														<lightning-icon
															class="slds-float_right slds-p-around_small error"
															icon-name="utility:warning"
															size="small"
															variant="error"
															alternative-text={labels.errorTitle}
															title={labels.errorTitle}></lightning-icon>
														<div
															if:true={isDesktop}
															class="slds-float_right slds-p-around_small success"
															style="content: ''; width: 48px; height: 48px"></div>
													</div>
												</lightning-layout-item>
											</template>
										</lightning-layout>
									</div>
								</div>
							</lightning-layout-item>
						</lightning-layout>
					</template>
				</div>
			</lightning-modal-body>
			<lightning-modal-footer>
				<div class="btn-container">
					<lightning-button
						label={labels.popupCancelButtonLabel}
						title={labels.popupCancelButtonLabel}
						icon-name="utility:close"
						variant="neutral"
						onclick={clickCancelBtn}>
					</lightning-button>
					<lightning-button
						label={labels.popupSaveButtonLabel}
						title={labels.popupSaveButtonLabel}
						icon-name="utility:save"
						variant="brand"
						onclick={clickSaveBtn}>
					</lightning-button>
				</div>
			</lightning-modal-footer>
		</div>
	</div>
</template>